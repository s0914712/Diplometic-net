<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <!-- 保持原有样式不变 -->
</head>
<body>
    <div class="container">
        <!-- 头部保持不变 -->
        
        <div class="control-panel">
            <div class="form-group">
                <div class="date-input">
                    <label for="start-date">开始日期:</label>
                    <input type="date" id="start-date">
                </div>
                
                <div class="date-input">
                    <label for="end-date">结束日期:</label>
                    <input type="date" id="end-date">
                </div>
                
                <!-- 拆分按钮 -->
                <div class="button-group">
                    <button id="generate-chart-btn" class="primary-btn">
                        <span>生成统计图表</span>
                        <span class="spinner" style="display: none;"></span>
                    </button>
                    <button id="generate-forecast-btn" class="secondary-btn">
                        <span>生成预测分析</span>
                        <span class="spinner" style="display: none;"></span>
                    </button>
                </div>
            </div>

            <!-- 加载状态和错误提示保持不变 -->
        </div>

        <!-- 图表容器保持不变 -->
    </div>

    <script>
        // 配置不同服务的API端点
        const CHART_API = 'https://chart-service.example.com/api/data';
        const FORECAST_API = 'https://forecast-service.example.com/api/forecast';

        // 初始化
        document.addEventListener('DOMContentLoaded', () => {
            // 绑定不同按钮的事件
            document.getElementById('generate-chart-btn').addEventListener('click', fetchCharts);
            document.getElementById('generate-forecast-btn').addEventListener('click', fetchForecast);
            
            // 其他初始化代码保持不变...
        });

        // 统计图表请求函数
        async function fetchCharts() {
            const loadingId = 'chart-loading';
            const button = document.getElementById('generate-chart-btn');
            
            try {
                showLoading(button, loadingId);
                clearCharts();
                
                const { startDate, endDate } = validateDates();
                const response = await fetch(CHART_API, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ start_date: startDate, end_date: endDate })
                });

                const result = await handleResponse(response);
                updateChart('aircraft-chart', result.charts.aircraft, '飞机活动架次');
                updateChart('vessel-chart', result.charts.vessel, '船舰活动架次');
                updateStats(result.stats);

            } catch (error) {
                handleError(error, '统计图表');
            } finally {
                hideLoading(button, loadingId);
            }
        }

        // 预测请求函数
        async function fetchForecast() {
            const loadingId = 'forecast-loading';
            const button = document.getElementById('generate-forecast-btn');
            
            try {
                showLoading(button, loadingId);
                clearForecast();

                const { startDate, endDate } = validateDates();
                const response = await fetch(FORECAST_API, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ start_date: startDate, end_date: endDate })
                });

                const result = await handleResponse(response);
                updateChart('forecast-chart', result.forecast, '未来活动预测');

            } catch (error) {
                handleError(error, '预测分析');
            } finally {
                hideLoading(button, loadingId);
            }
        }

        // 通用响应处理
        async function handleResponse(response) {
            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.error || `请求失败 (状态码: ${response.status})`);
            }
            return response.json();
        }

        // 日期验证函数
        function validateDates() {
            const startDate = document.getElementById('start-date').value;
            const endDate = document.getElementById('end-date').value;

            if (!startDate || !endDate) throw new Error('请选择开始和结束日期');
            if (new Date(startDate) > new Date(endDate)) throw new Error('开始日期不能晚于结束日期');
            
            return { startDate, endDate };
        }

        // 加载状态管理
        function showLoading(button, loadingId) {
            button.disabled = true;
            button.querySelector('span:first-child').style.display = 'none';
            button.querySelector('.spinner').style.display = 'inline-block';
        }

        function hideLoading(button, loadingId) {
            button.disabled = false;
            button.querySelector('span:first-child').style.display = 'inline-block';
            button.querySelector('.spinner').style.display = 'none';
        }

        // 错误处理
        function handleError(error, serviceName) {
            console.error(`${serviceName}请求失败:`, error);
            showError(`${serviceName}获取失败: ${error.message}`);
            
            // 特定错误处理
            if(serviceName === '预测分析'){
                document.getElementById('forecast-chart').innerHTML = `
                    <div class="error-placeholder">
                        <div class="icon">⚠️</div>
                        <p>预测服务暂时不可用</p>
                        <small>${error.message}</small>
                    </div>`;
            }
        }

        // 其他辅助函数保持不变...
    </script>
</body>
</html>
